<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.innovation.mapper.UserMapper">
    <select id="selectByUsername" parameterType="String" resultType="com.innovation.entity.User">
        SELECT * FROM user WHERE username = #{username}
    </select>

    <insert id="insert" parameterType="com.innovation.entity.User">
        INSERT INTO user (
            username, password, role, real_name,
            student_id, class_name, teacher_id, department,
            email, phone, create_time, update_time
        ) VALUES (
                     #{username}, #{password}, #{role}, #{realName},
                     #{studentId}, #{className}, #{teacherId}, #{department},
                     #{email}, #{phone}, #{createTime}, #{updateTime}
                 )
    </insert>

    <select id="selectAllTeachers" resultType="com.innovation.entity.User">
        SELECT * FROM user WHERE role = 1  -- 1表示教师角色
    </select>

    <select id="selectStudentByStudentId" parameterType="String" resultType="com.innovation.entity.User">
        SELECT * FROM user WHERE role = 2 AND student_id = #{studentId}  -- 2表示学生角色
    </select>

    <select id="selectById" parameterType="Integer" resultType="com.innovation.entity.User">
        SELECT * FROM user WHERE user_id = #{userId}
    </select>

    <select id="selectUsersByKeyword" parameterType="String" resultType="com.innovation.entity.User">
        SELECT * FROM user
        <where>
            <if test="keyword != null and keyword != ''">
                AND (username LIKE CONCAT('%', #{keyword}, '%')
                OR real_name LIKE CONCAT('%', #{keyword}, '%'))
            </if>
        </where>
        ORDER BY user_id DESC
    </select>

    <delete id="deleteById" parameterType="Integer">
        DELETE FROM user WHERE user_id = #{userId}
    </delete>

    <update id="update" parameterType="com.innovation.entity.User">
        UPDATE user
        <set>
            <if test="username != null">username = #{username},</if>
            <if test="password != null">password = #{password},</if>
            <if test="role != null">role = #{role},</if>
            <if test="realName != null">real_name = #{realName},</if>
            <if test="studentId != null">student_id = #{studentId},</if>
            <if test="className != null">class_name = #{className},</if>
            <if test="teacherId != null">teacher_id = #{teacherId},</if>
            <if test="department != null">department = #{department},</if>
            <if test="email != null">email = #{email},</if>
            <if test="phone != null">phone = #{phone},</if>
            update_time = #{updateTime}
        </set>
        WHERE user_id = #{userId}
    </update>
</mapper>